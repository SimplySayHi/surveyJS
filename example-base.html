<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Demo Base | surveyJS - Generate &amp; Manage a Survey from a JSON Object</title>
    <meta name="description" content="Generate & Manage a Survey from a JSON Object">
    <meta name="keywords" content="survey, question, answer, jquery, javascript, plugin, ajax, json">
    <meta name="author" content="Valerio Di Punzio">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css?family=Fredericka+the+Great|Raleway:200" rel="stylesheet">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/survey.css">
    <link rel="stylesheet" href="css/demo.css">
</head>

<body>
    
    <div class="container">
        <div class="text-center">
            <h1>surveyJS</h1>
            <p>
                This survey is generated with Javascript/jQuery.
                <br />
                This is a basic demo with default inputs.
            </p>
        </div>
        <div class="surveyjs-container card panel-primary mb-4" data-surveyjs-container>
            <div class="card-header no-bg">
                <div class="card-header-inner media">
                    <div class="media-left"><img class="surveyjs-img" data-surveyjs-img /></div>
                    <div class="media-body media-middle">
                        <h3 class="surveyjs-title panel-title text-green mt-0" data-surveyjs-title></h3>
                        <p class="surveyjs-description" data-surveyjs-description></p>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <form action="json/survey.json" name="surveyjs-form" class="surveyjs-form" data-surveyjs-form novalidate="">
                    <div class="surveyjs-body questionsList clearfix" data-surveyjs-body></div>
                    <div class="surveyjs-footer">
                        <div class="surveyjs-question-box text-right" data-formjs-question>
                            <div class="surveyjs-answers-box form-group">
                                <div class="text-left small">
                                    L'interessato persta il consenso al trattamento dei propri dati personali per la creazione di profili e per l'analisi delle sue abitudini o scelte di consumo sulla base del dettaglio dei suoi acquisti nonch&egrave; dei dati forniti direttamente dal cliente.
                                </div>
                                <div class="radio form-check-inline">
                                    <input class="form-check-input" data-exclude-storage="" data-name="bind-surveyjs-answer"/>
                                    <label class="form-check-label">
                                        <span></span>
                                    </label>
                                </div>
                                <div class="radio form-check-inline">
                                    <input class="form-check-input" data-exclude-storage="" data-name="bind-surveyjs-answer"/>
                                    <label class="form-check-label">
                                        <span></span>
                                    </label>
                                </div>
                                <div class="surveyjs-field-error-message small">
                                    Per proseguire &egrave; necessario selezionare una risposta.
                                </div>
                            </div>
                        </div>
                        <div class="surveyjs-question-box text-right" data-formjs-question>
                            <div class="surveyjs-answers-box form-group">
                                <div class="text-left small">
                                    Devi accettare questa condizione per sblocacre il bottone di invio del quesitonario.
                                </div>
                                <div class="radio form-check-inline">
                                    <input class="form-check-input" type="radio" name="prova-00" id="radio-prova-00-a" value="yeee" required="" />
                                    <label class="form-check-label" for="radio-prova-00-a">
                                        <span>true</span>
                                    </label>
                                </div>
                                <div class="radio form-check-inline">
                                    <input class="form-check-input" type="radio" name="prova-00" id="radio-prova-00-b" value="" required="" />
                                    <label class="form-check-label" for="radio-prova-00-b">
                                        <span>false</span>
                                    </label>
                                </div>
                                <div class="surveyjs-field-error-message small">
                                    Per proseguire &egrave; necessario accettare.
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-primary d-block mx-auto" disabled type="submit">SEND</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div id="modal-notification" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Mission complete</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">X</span></button>
                </div>
                <div class="modal-body">
                    <div class="media">
                        <div class="media-left pr-3"><img src="img/survey-image.png" class="surveyjs-img" /></div>
                        <div class="media-body media-middle">
                            <h3 class="text-green">Congratulations!</h3>
                            <p class="m-0">
                                You completed the survey and gained <b>100 points</b>.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DYNAMICALLY LOAD POLYFILLS -> REQUIRED FOR FORMJS TO SUPPORT IE 10/11 -->
    <script src="https://cdn.polyfill.io/v3/polyfill.min.js?features=Array.from,Element.prototype.closest,Element.prototype.matches,Event,WeakMap"></script>
    
    <script src="js/vendors/jquery-1.12.4.min.js"></script>
    <script src="js/vendors/bootstrap.bundle.min.js"></script>
    <script src="js/vendors/jquery_stackslider.js"></script>
    
    <script src="js/modules/web_storage.js"></script>
    <script src="js/modules/formJS.js"></script>
    <script src="js/modules/surveyJS.js"></script>
    
    <!-- MINIFIED VERSION WITH ALL MODULES -->
    <!--<script src="js/surveyJS.min.js"></script>-->
    
    <script type="text/javascript">
        $(function(){

            var $surveyCont = $('[data-surveyjs-container]'),
                $surveyForm = $surveyCont.find('[data-surveyjs-form]'),
                $surveyBtn = $surveyForm.find('.surveyjs-submit-btn');
            
            /* ADD A NEW LANGUAGE */
            /* 
            var myLang = {
                loadingBox:         '<div class="surveyjs-loading"><i class="glyphicon glyphicon-refresh icon-spin"></i> DE Caricamento in corso...</div>',
                selectFirstOption:  'DE Seleziona una risposta...',
                textareaPlaceholder:'DE Scrivi la tua risposta...',
                maxChoiceText:      'DE RISPOSTE MAX',
                fieldErrorMessage:  'DE &Egrave; necessario rispondere.'
            };
            SURVEY.addLanguage( 'de', myLang );
            */

            /* OVERRIDE SOME VALUES OF AN EXISTING LANGUAGE */
            /* 
            var myLang = {
                selectFirstOption:  'IT Seleziona una risposta...',
                textareaPlaceholder:'IT Scrivi la tua risposta...',
                maxChoiceText:      'IT RISPOSTE MAX',
            };
            SURVEY.addLanguage( 'it', myLang );
            */
            
            // SETUP FOR THE SURVEY
            SURVEY.setup({
                url: 'json/survey.json',
                
                fieldOptions:Â {
                    onValidation: function( fields ){
                        console.log( 'onValidation callback fields: ', fields );
                        if( fields.length > 1 ){
                            
                            for( var f=0; f<fields.length; f++ ){
                                var obj = fields[f];
                                if( !obj.result ){
                                    var $box = $(obj.field).closest('[data-formjs-question]');
                                    $('html, body').animate({ scrollTop: $box.offset().top }, 400);
                                    break;
                                }
                            }
                            
                        } else {
                            var fieldObj = fields[0];
                            console.log('onValidation of one field ', fieldObj);
                            if( fieldObj.field.name === 'prova-00' ){
                                var $btn = $(fieldObj.field).closest('form').find('[type="submit"]'),
                                    isValidValue = fieldObj.field.value.trim().length > 0;

                                $btn.prop('disabled', !isValidValue);
                            }
                        }
                    }
                },
                formOptions: {
                    beforeSend: function( data ){
                        console.log('Survey formOptions.beforeSend call...', data);

                        if( !data.stopExecution ){
                            $surveyBtn.addClass('surveyjs-submit-sending');
                            $surveyCont.find('.alert').remove();
                            data.formData = 'surveyJSON=' + JSON.stringify( data.formData );
                        }

                        return data;
                    },
                    onSubmitComplete: function( ajaxData ){
                        console.log('formOptions.onSubmitComplete', ajaxData);
                        $surveyBtn.removeClass('surveyjs-submit-sending');
                    },
                    onSubmitError: function( ajaxData ){
                        console.log('Survey formOptions.onSubmitError', ajaxData);
                        // PRINT THE ERROR MESSAGE AFTER THE FORM
                        $surveyForm.closest('.surveyjs-container').append( '<div class="alert alert-danger text-center" role="alert"><p class="my-3">Generic error, please retry.</p></div>' );
                    },
                    onSubmitSuccess: function( ajaxData ){
                        console.log('Survey formOptions.onSubmitSuccess', ajaxData);
                        if( typeof ajaxData === 'string' ){
                            try{
                                ajaxData = JSON.parse(ajaxData);
                            } catch(error){
                                throw new Error('String returned from ajax call to "' + ajaxOptions.url + '" is not a valid JSON string');
                            }
                        }

                        if( $.isPlainObject( ajaxData ) ){
                            if( ajaxData.data.status === 'success' ){
                                // REMOVE THE SURVEY FORM FROM THE PAGE AND PRINT A RESPONSE MESSAGE
                                $surveyForm.parent().html( '<div class="alert alert-success text-center" role="alert"><p class="my-3">Great! You completed the mission.</p></div>' );

                                // OPEN THE BOOTSTRAP MODAL TO SHOW A CONGRATULATION MESSAGE
                                $('#modal-notification').modal('show');
                            } else {
                                // PRINT THE ERROR MESSAGE AFTER THE FORM
                                $surveyForm.closest('.surveyjs-container').append( '<div class="alert alert-danger text-center" role="alert"><p class="my-3">Generic error, please retry.</p></div>' );
                            }
                        }
                    }
                },
                
                onInitSuccess: function( data, $surveyForm ){
                    var $surveyBody = $surveyForm.find('.surveyjs-body'),
                        initStatus = data.status;
                    
                    if( initStatus === 'success' ){
                        // SUCCESS CODE
                    } else {
                        $surveyForm.find('.surveyjs-footer').remove();
                        $surveyBody.html( '<div class="surveyjs-message">Errore durante il caricamento. Per favore, ricarica la pagina.</div>' );
                    }
                },
                onInitError: function( jqXHR, textStatus, errorThrown, $surveyForm ){
                    console.log('_setJSONurl(\''+ $surveyForm.attr('action') +'\') RETURNED AN ERROR:');
                    console.log('XHR: ', jqXHR);
                    console.log('STATUS: ', textStatus);
                    console.log('ERROR: ', errorThrown);
                    
                    $surveyForm.find('.surveyjs-loading').html( '<div class="surveyjs-message">Errore durante il caricamento. Per favore, ricarica la pagina.</div>' );
                }
            });

        });
    </script>
</body>
</html>