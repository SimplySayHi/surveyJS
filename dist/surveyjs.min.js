/* surveyJS v4.0.2 | Valerio Di Punzio (@SimplySayHi) | https://www.valeriodipunzio.com/plugins/surveyJS/ | https://github.com/SimplySayHi/surveyJS | MIT license */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("formjs-plugin")):"function"==typeof define&&define.amd?define(["formjs-plugin"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).Survey=t(e.Form)}(this,(function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(e);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return u(e)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=o(e);if(t){var s=o(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return c(this,r)}}function d(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}function f(){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var a=d(e,t);if(a){var s=Object.getOwnPropertyDescriptor(a,t);return s.get?s.get.call(arguments.length<3?e:r):s.value}},f.apply(this,arguments)}var p=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:location.href,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r.headers=new Headers(r.headers),r.timeout>0){var a=new AbortController,s=a.signal;r.signal=s,e=window.setTimeout((function(){a.abort()}),r.timeout)}return fetch(t,r).then((function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})).catch((function(e){throw new Error(e.message)})).finally((function(){e&&window.clearTimeout(e)}))},v="sjs:destroy",y="sjs:init",m=function e(t){return Object.getOwnPropertyNames(t).forEach((function(r){var s=t[r];"object"===a(s)&&null!==s&&e(s)})),Object.freeze(t)},h=function(e){return"[object Object]"===Object.prototype.toString.call(e)},b=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Array.from(arguments).slice(1).filter((function(e){return!!e})).forEach((function(r){Object.keys(r).forEach((function(a){Array.isArray(r[a])?t[a]=(t[a]||[]).concat(r[a].slice(0)):h(r[a])?t[a]=e(t[a]||{},r[a]):Array.isArray(t[a])?t[a].push(r[a]):t[a]=r[a]}))})),t},g=function(e,t,r){r=b({},{bubbles:!0},r);var a=new CustomEvent(t,r);e.dispatchEvent(a)},j=function(e){var t=e.closest("[data-question-id]");return t&&t.getAttribute("data-question-id")||""},w=function(e){return h(e)&&0===Object.getOwnPropertyNames(e).length},q=function(e,t){return Object.keys(e).reduce((function(t,r){var a=new RegExp("{{"+r+"}}","g");return t.replace(a,e[r])}),t)},O=function(e){return e[0].sort&&e.sort((function(e,t){return e.sort>t.sort})),e},k=function(){var e=function(){var e="check_storage";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}();return e&&(Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t))},Storage.prototype.getObject=function(e){var t=this.getItem(e);return t&&JSON.parse(t)}),{isAvailable:e}},S=function(e,t){for(var r=e.length,a={},s=0;s<r;s++){var n=e[s];if(n.id==t){a=n;break}}return a},x={cssClasses:{checkbox:"form-check-input",field:"form-control",file:"form-control-file",label:"form-check-label",radio:"form-check-input",wrapper:{checkbox:"form-check",field:"",radio:"form-check"}},formOptions:{getFormData:{formOptions:{getFormData:function(e,t){var r=this,a=r.$form,s=Array.from(a.closest("[data-surveyjs-wrapper]").querySelectorAll('[data-surveyjs-form] input:not([type="reset"]):not([type="submit"]):not([type="button"]), [data-surveyjs-form] select, [data-surveyjs-form] textarea, [data-surveyjs-external] [data-field]')),n={answers:[],id:r.data.id},o="",i="";return s.forEach((function(e){var s=e.type,u=e.name;if(u!==o||s!==i){e.matches("[data-required-from]")||(o=u,i=s);var c=j(e),l={question:c,answer:{value:t?e.value.trim():e.value||""}};if(!e.matches("[data-required-from]")&&""!==c&&!w(S(r.data.questions,c))){if("radio"===s){var d=(e.closest("form")?a:e.closest(r.options.fieldOptions.questionContainer)).querySelector('[name="'+u+'"]:checked');l.answer.value=d&&d.value||"",d&&d.matches("[data-require-more]")&&(l.answer.related=a.querySelector('[data-required-from="#'+d.id+'"]').value)}"checkbox"===s&&e.matches("[data-checks]")&&(l.answer.value=[],Array.from(a.querySelectorAll('[name="'+u+'"]:checked')).forEach((function(e){l.answer.value.push(e.value)}))),n.answers.push(l)}}})),n}}}.formOptions.getFormData},initAjaxOptions:{cache:"no-store",credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json"},method:"GET",mode:"same-origin",redirect:"follow",timeout:0},messages:{maxChoice:"answers max",error:"Answer is necessary.",errorMultiChoice:"You must choose from {{checksMin}} to {{checksMax}} answers."},showErrorMessage:!0,templates:{error:'<div class="surveyjs-error-message">{{errorMessage}}</div>',input:'<input {{fieldAttributes}} name="surveyjs-answer-{{questionNumber}}{{addMoreName}}" class="surveyjs-input surveyjs-{{answerType}} {{fieldClasses}}" />',label:'<label for="{{answerCode}}" class="surveyjs-label {{labelClasses}}">{{labelString}}</label>',loading:'<div class="surveyjs-loading" data-surveyjs-loading>Loading...</div>',select:'<select {{fieldAttributes}} name="surveyjs-answer-{{questionNumber}}{{addMoreName}}" class="surveyjs-select {{fieldClasses}}">{{optionsHtml}}</select>',textarea:'<textarea {{fieldAttributes}} name="surveyjs-answer-{{questionNumber}}" class="surveyjs-textarea {{fieldClasses}}"></textarea>',wrapper:{field:'<div class="surveyjs-field-wrapper surveyjs-{{answerType}}-wrapper {{wrapperClasses}}">{{fieldTemplate}}{{labelTemplate}}</div>',nested:'<div class="surveyjs-field-wrapper surveyjs-nested-wrapper">{{labelTemplate}}<div class="surveyjs-nested-inner">{{nestedFieldsHTML}}</div></div>',question:'<div class="surveyjs-question-wrapper" data-question-id="{{questionId}}" data-formjs-question><div class="surveyjs-question-text">{{questionText}}</div><div class="surveyjs-answers-wrapper">{{answersHTML}}</div><div class="surveyjs-errors-wrapper" data-surveyjs-errors>{{errorTemplates}}</div></div>',related:'<div class="surveyjs-field-wrapper surveyjs-related-wrapper input-group"><div class="input-group-prepend"><div class="surveyjs-radio-wrapper input-group-text form-check">{{fieldTemplate}}{{labelTemplate}}</div></div>{{relatedFieldHTML}}</div>'}},useWebStorage:!0},C={storageName:"Survey_"+location.href+"_{{surveyFormName}}_surveyId[{{surveyId}}]"};function T(e){var t=e.target.surveyjs;e.detail.then((function(){t.options.useWebStorage&&sessionStorage.removeItem(t.internals.storageName)}))}var E=function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=e.length,s=0;s<a;s++){var n=e[s];if(n.name===t){if(r&&n.value!==r)continue;return s}}return-1};function A(e){var t,r,a,s=e.detail.$field,n=e.detail.errors,o=s.closest("form").surveyjs,i=o.options,u=s.closest(i.fieldOptions.questionContainer).querySelector("[data-surveyjs-errors]"),c=j(s),l=S(o.data.questions,c);if(w(l))return!0;if(u&&n&&h(l.errorMessage)){var d=Object.keys(n);if(n.rule){var f=d.indexOf("rule");r=f,a=0,(t=d).splice(a,0,t.splice(r,1)[0]),d=t}var p=d.reduce((function(e,t){var r=l.errorMessage[t]||"";return e+(r?i.templates.error.replace("{{errorMessage}}",r):"")}),"");u.innerHTML=p}if(!e.detail.isCheckingForm&&i.useWebStorage&&!s.matches("[data-exclude-storage]")){var v=o.internals.storageName,y=sessionStorage.getObject(v)||[],m=s.name,b=s.value,g=s.matches("[data-required-from]"),q=s.matches("[data-checks]"),O=s.matches("[data-require-more]"),k=g?document.querySelector(s.getAttribute("data-required-from")):null,x=E(y,m+"-more");!O&&!g&&x>=0&&y.splice(x,1);var C=E(y,m,!!q&&b);if(C>=0)y.splice(C,1),(q&&s.checked||!q&&""!==b)&&y.push({name:m,value:b});else if(""!==b){if(g){var T=E(y,k.name);T>=0&&y.splice(T,1),y.push({name:k.name,value:k.value})}y.push({name:m,value:b})}sessionStorage.setObject(v,y)}!l.required||s.required||s.matches("[data-required-from]")||(s.required=!0,o.validateField(s))}var M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return O(e).reduce((function(e,t){return e+'<option value="'.concat(t.value,'">').concat(t.label,"</option>")}),"")},N=function(e,t,r){var a=["data","id","label","nested","related","sort"];/^(option|textarea)$/.test(e.type)&&a.push("type","value");var s="";return Object.keys(e).filter((function(e){return-1===a.indexOf(e)})).forEach((function(t){s+=" ".concat(t,'="').concat(e[t],'"')})),e.data&&Object.keys(e.data).forEach((function(t){s+=" data-".concat(function(){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").trim().replace(/(([_ ])([a-z]))|(([a-z])?([A-Z]))/g,(function(e,t,r,a,s,n,o){return(a?"-"+a:(n||"")+"-"+o).toLowerCase()}));return e?t.toUpperCase():t}(t),'="').concat(e.data[t],'"')})),r&&(s+=" required"),e.related&&(s+=" data-require-more"),(s+=' id="'.concat(t,'"')).trim()},L=function e(t,r,a){var s="",n="";return O(t).forEach((function(o,i){var u,c="option"===o.type?"select":o.type;if("select"!==c||n!==c){n=c,r.question.checks&&(o=b({},o,{data:{checks:r.question.checks}}));var l="".concat(c,"-").concat(r.surveyId,"-").concat(r.question.id,"-").concat("select"===c?i+1:o.id),d={questionNumber:r.question.index+1,wrapperClasses:a.cssClasses.wrapper[c]||a.cssClasses.wrapper.field,fieldAttributes:N(o,l,r.question.isRequired),fieldClasses:a.cssClasses[c]||a.cssClasses.field,answerType:c,answerCode:l,addMoreName:"",labelString:o.label||"",labelClasses:a.cssClasses.label},f="";if(o.related){var p=o.related.type||"select",v="select"===p,y=v?b({},o):o.related;y.type=v?"option":p,y.id="",y.data=b({},y.data,{requiredFrom:"#"+l}),delete y.related;var m={fieldAttributes:N(y,"",!1),answerType:p,addMoreName:"-more",fieldClasses:v?a.cssClasses.select:a.cssClasses[p]||a.cssClasses.field};if(f=a.templates[p]||a.templates.input,v){var h=M(o.related);f=f.replace("{{optionsHtml}}",h)}f=q(m,f)}var g=function(e,t){return{field:t[e]||t.input,label:/^(checkbox|nested|radio|related)$/.test(e)?t.label:"",wrapper:t.wrapper[e]||t.wrapper.field}}(o.related?"related":o.nested?"nested":c,a.templates),j="";o.nested&&(j=e(o.nested,r,a));var w="";"select"===c&&(w=M(t)),u=g.wrapper.replace("{{relatedFieldHTML}}",f).replace("{{fieldTemplate}}",g.field).replace("{{optionsHtml}}",w).replace("{{labelTemplate}}",g.label).replace("{{nestedFieldsHTML}}",j),s+=q(d,u)}})),s},I=function(e,t,r){return O(e).reduce((function(e,a,s){if(a.external)return e;var n=r.templates.wrapper.question,o=a.id,i=s+1,u={surveyId:t,question:{id:o,index:s,isRequired:!!a.required}};a.checks&&(u.question.checks=a.checks);var c=L(a.answers,u,r),l=a.checks?JSON.parse(a.checks):"",d=l[0]||"",f=l[1]||"",p=l&&r.messages.maxChoice?" ("+f+" "+r.messages.maxChoice+")":"",v={questionId:o,questionNumber:i,questionText:a.question+p,answersHTML:c};if(n=q(v,n),r.showErrorMessage){var y=""!==l?r.messages.errorMultiChoice:a.errorMessage||r.messages.error;h(y)&&(y=""),n=n.replace(/{{errorTemplates}}/g,y)}return e+q({checksMin:d,checksMax:f},n)}),"")},F=function(e,t,r){var a=I(e.questions,e.id,r);t.querySelector("[data-surveyjs-body]").insertAdjacentHTML("beforeend",a);var s=e.questions.filter((function(e){return e.external}));if(s.length>0){var n=t.closest("[data-surveyjs-wrapper]");s.forEach((function(t,r){var a=n.querySelector('[data-surveyjs-external="'+(r+1)+'"]');a.setAttribute("data-question-id",t.id),t.answers.forEach((function(r,s){var n=a.querySelectorAll("[data-field]")[s],o={id:"".concat(r.type,"-").concat(e.id,"-").concat(t.id,"-").concat(r.id),type:r.type,value:r.value,required:!!t.required};Object.keys(o).forEach((function(e){n[e]=o[e]}));var i=n.closest("[data-answer]");i.querySelector("label").setAttribute("for",o.id),i.querySelector("[data-label]").innerHTML=r.label,a.querySelector("[data-question]").innerHTML=t.question}))}))}},_=function(e,t){var r=sessionStorage.getObject(t.storageName);if(r){var a=e.closest("[data-surveyjs-wrapper]");r.forEach((function(e){var t=a.querySelector('[name="'+e.name+'"]'),r=t.matches('[type="radio"], [type="checkbox"]'),s=r?a.querySelector('[name="'+e.name+'"][value="'+e.value+'"]'):t;r?s.checked=!0:s.value=e.value}))}},H=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(d,e);var t,r,a,c=l(d);function d(e){var t,r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(s(this,d),!a.url||"string"!=typeof a.url)throw new Error('"options.url" is missing or not a string!');a=b({},d.prototype.options,a),k().isAvailable||(a.useWebStorage=!1);var n=u(r=c.call(this,e,a));n.internals=C;var i=n.$form;a=n.options;var l=n.internals;i.surveyjs=n,i.querySelector("[data-surveyjs-body]").insertAdjacentHTML("beforebegin",a.templates.loading);var v=p(a.url,a.initAjaxOptions).then((function(e){return"success"!==e.status.toLowerCase()?Promise.reject(e):e.data.questions&&e.data.questions.length>0?(l.storageName=l.storageName.replace(/{{surveyId}}/,e.data.id),l.storageName=l.storageName.replace(/{{surveyFormName}}/,i.getAttribute("name")||""),F(e.data,i,a),a.useWebStorage&&_(i,l),Object.defineProperty(n,"data",{value:m(e.data)}),i.addEventListener("fjs.field:validation",A),i.addEventListener("fjs.form:submit",T),a.formOptions.onInitCheckFilled?n._&&"function"==typeof n._.asyncInitEnd?n._.asyncInitEnd().then((function(){return n.isInitialized=!0,i.closest("[data-surveyjs-wrapper]").classList.add("surveyjs-init-success"),e})):f((t=u(r),o(d.prototype)),"validateFilledFields",t).call(t).then((function(){return n.isInitialized=!0,i.closest("[data-surveyjs-wrapper]").classList.add("surveyjs-init-success"),e})):(n.isInitialized=!0,i.closest("[data-surveyjs-wrapper]").classList.add("surveyjs-init-success"),e)):e})).finally((function(){var e=i.querySelector("[data-surveyjs-loading]");e&&e.parentNode.removeChild(e)}));return g(i,y,{detail:v}),r}return t=d,a=[{key:"setOptions",value:function(e){d.prototype.options=b({},d.prototype.options,e)}}],(r=[{key:"destroy",value:function(){var e;f(o(d.prototype),"destroy",this).call(this),(e=this.$form).removeEventListener("fjs.field:validation",A),e.removeEventListener("fjs.form:submit",T),delete e.surveyjs,g(this.$form,v)}}])&&n(t.prototype,r),a&&n(t,a),Object.defineProperty(t,"prototype",{writable:!1}),d}(r.default);return H.prototype.isInitialized=!1,H.prototype.options=x,H.prototype.version="4.0.2",H}));
//# sourceMappingURL=surveyjs.min.js.map
