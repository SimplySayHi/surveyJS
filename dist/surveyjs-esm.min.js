/* surveyJS v3.0.0 | Valerio Di Punzio (@SimplySayHi) | https://www.valeriodipunzio.com/plugins/surveyJS/ | https://github.com/SimplySayHi/surveyJS | MIT license */
import e from"formjs-plugin";const s="sjs:init",t=e=>(Object.getOwnPropertyNames(e).forEach(s=>{const r=e[s];"object"==typeof r&&null!==r&&t(r)}),Object.freeze(e)),r=e=>"[object Object]"===Object.prototype.toString.call(e),a=function(e={}){return Array.from(arguments).slice(1).filter(e=>!!e).forEach(s=>{Object.keys(s).forEach(t=>{Array.isArray(s[t])?e[t]=(e[t]||[]).concat(s[t].slice(0)):r(s[t])?e[t]=a(e[t]||{},s[t]):Array.isArray(e[t])?e[t].push(s[t]):e[t]=s[t]})}),e},o=e=>{const s=e.closest("[data-question-id]");return s&&s.getAttribute("data-question-id")||""},i=e=>r(e)&&0===Object.getOwnPropertyNames(e).length,n=(e,s)=>Object.keys(e).reduce((s,t)=>{const r=new RegExp("{{"+t+"}}","g");return s.replace(r,e[t])},s),l=e=>(e[0].sort&&e.sort((e,s)=>e.sort>s.sort),e),c=()=>{const e=(()=>{const e="check_storage";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}})();return e&&(Storage.prototype.setObject=function(e,s){this.setItem(e,JSON.stringify(s))},Storage.prototype.getObject=function(e){const s=this.getItem(e);return s&&JSON.parse(s)}),{isAvailable:e}},d=(e,s)=>{const t=e.questions,r=t.length;let a={};for(let e=0;e<r;e++){const r=t[e];if(r.id==s){a=r;break}}return a},u={cssClasses:{checkbox:"form-check-input",default:"form-control",file:"form-control-file",label:"form-check-label",radio:"form-check-input",wrapper:{checkbox:"form-check",default:"",radio:"form-check"}},fieldErrorFeedback:!0,formOptions:{getFormData:{formOptions:{getFormData:function(){const e=this,s=e.formEl,t=Array.from(s.closest("[data-surveyjs-container]").querySelectorAll('[data-surveyjs-form] input:not([type="reset"]):not([type="submit"]):not([type="button"]), [data-surveyjs-form] select, [data-surveyjs-form] textarea, [data-name="bind-surveyjs-answer"]')),r={answers:[],id:e.data.id};let a="",n="";return t.forEach(t=>{const l=t.type,c=t.name;if(c===a&&l===n)return;t.matches("[data-required-from]")||(a=c,n=l);const u=o(t),p={question:u,answer:{value:t.value||""}};if(!t.matches("[data-required-from]")&&""!==u&&!i(d(e.data,u))){if("radio"===l){const r=(t.closest("form")?s:t.closest(e.options.fieldOptions.questionContainer)).querySelector('[name="'+c+'"]:checked');p.answer.value=r&&r.value||"",r&&r.matches("[data-require-more]")&&(p.answer.related=s.querySelector('[data-required-from="#'+r.id+'"]').value)}"checkbox"===l&&t.matches("[data-checks]")&&(p.answer.value=[],Array.from(s.querySelectorAll('[name="'+c+'"]:checked')).forEach(e=>{p.answer.value.push(e.value)})),r.answers.push(p)}}),r}}}.formOptions.getFormData},initAjaxOptions:{cache:"no-store",credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json"},method:"GET",mode:"same-origin",redirect:"follow",timeout:0},messages:{maxChoice:"ANSWERS MAX",errorMessage:"Answer is necessary.",errorMessageMultiChoice:"You must choose from {{checksMin}} to {{checksMax}} answers."},templates:{error:'<div class="surveyjs-error-message">{{errorMessage}}</div>',input:'<input {{fieldAttributes}} name="surveyjs-answer-{{questionNumber}}{{addMoreName}}" class="surveyjs-input surveyjs-{{answerType}} {{fieldClasses}}" />',label:'<label for="{{answerCode}}" class="surveyjs-label {{labelClasses}}">{{labelString}}</label>',loading:'<div class="surveyjs-loading" data-surveyjs-loading>Loading...</div>',question:'<div class="surveyjs-question-wrapper" data-question-id="{{questionId}}" data-formjs-question><div class="surveyjs-question-header">Question {{questionNumber}}</div><div class="surveyjs-question-body"><div class="surveyjs-question-text">{{questionText}}</div><div class="surveyjs-answers-wrapper form-group">{{answersHTML}}{{errorsHTML}}</div></div></div>',select:'<select {{fieldAttributes}} name="surveyjs-answer-{{questionNumber}}{{addMoreName}}" class="surveyjs-select {{fieldClasses}}">{{optionsHtml}}</select>',textarea:'<textarea {{fieldAttributes}} name="surveyjs-answer-{{questionNumber}}" class="surveyjs-textarea {{fieldClasses}}"></textarea>',wrapper:{default:'<div class="surveyjs-field-wrapper surveyjs-wrapper-{{answerType}} {{wrapperClasses}}">{{fieldTemplate}}{{labelTemplate}}</div>',errors:'<div class="surveyjs-errors-wrapper" data-surveyjs-errors>{{errorTemplates}}</div>',nested:'<div class="surveyjs-field-wrapper surveyjs-nested-parent surveyjs-wrapper-{{answerType}}">{{labelTemplate}}<div class="surveyjs-nested-container surveyjs-field-indent">{{nestedFieldsHTML}}</div></div>',related:'<div class="surveyjs-field-wrapper input-group {{wrapperClasses}}"><div class="input-group-prepend"><div class="input-group-text form-check surveyjs-wrapper-radio">{{fieldTemplate}}{{labelTemplate}}</div></div>{{relatedFieldHTML}}</div>'}},useWebStorage:!0},p={storageArray:[],storageName:"Survey_"+location.href+"_{{surveyFormName}}_surveyId[{{surveyId}}]"};function m(e){const s=e.target.formjs;e.data.then(()=>{s.options.useWebStorage&&sessionStorage.removeItem(s.internals.storageName)})}const f=(e,s,t="")=>{const r=sessionStorage.getObject(e.storageName);if(r){const e=r.length;for(let a=0;a<e;a++){const e=r[a];if(e.name===s){if(t&&e.value!==t)continue;return a}}}return-1};function y(e){const s=e.data.fieldEl,t=e.data.errors,r=e.target.formjs,a=o(s),n=d(r.data,a);if(i(n))return!0;if(t&&isPlainObject(n.errorMessage)){let e=Object.keys(t);if(t.rule){const s=e.indexOf("rule");c=s,u=0,(l=e).splice(u,0,l.splice(c,1)[0]),e=l}const a=s.closest(r.options.fieldOptions.questionContainer).querySelector("[data-surveyjs-errors]"),o=e.reduce((e,s)=>{const t=n.errorMessage[s]||"";return e+(t?r.options.templates.error.replace("{{errorMessage}}",t):"")},"");a.innerHTML=o}var l,c,u;if(r.options.useWebStorage&&!s.matches("[data-exclude-storage]")){const e=r.internals,t=s.value,a=s.matches("[data-required-from]"),o=s.matches("[data-checks]"),i=s.matches("[data-require-more]"),n=a?document.querySelector(s.getAttribute("data-required-from")):null,l=f(e,s.name,!!o&&t),c=f(e,s.name+"-more");let d=e.storageArray;if(i||a||-1===c||d.splice(c,1),-1!==l)o?s.checked||d[l].value!==t?d.push({name:s.name,value:t}):d.splice(l,1):""!==t?d[l].value=t:d.splice(l,1);else if(""!==t){if(a&&""!==t){const s=f(e,n.name);-1!==s&&d.splice(s,1),d.push({name:n.name,value:n.value})}if(d.push({name:s.name,value:t}),i){const e=s.closest("form").querySelector('[data-required-from="#'+s.id+'"]');d.push({name:e.name,value:e.value})}}sessionStorage.setObject(e.storageName,d)}n.required&&!s.required&&(s.required=!0,r.validateField(s))}const v=(e=[])=>l(e).reduce((e,s)=>e+`<option value="${s.value}">${s.label}</option>`,""),b=(e,s,t)=>{const r=["data","id","label","nested","related","sort"];/^(option|textarea)$/.test(e.type)&&r.push("type","value");let a="";return Object.keys(e).filter(e=>-1===r.indexOf(e)).forEach(s=>{a+=` ${s}="${e[s]}"`}),e.data&&Object.keys(e.data).forEach(s=>{a+=` data-${((e="",s=!1)=>{let t=e.trim().replace(/(([_ ])([a-z]))|(([a-z])?([A-Z]))/g,(e,s,t,r,a,o,i)=>(r?"-"+r:(o||"")+"-"+i).toLowerCase());return s?t.toUpperCase():t})(s)}="${e.data[s]}"`}),t&&(a+=" required"),e.related&&(a+=" data-require-more"),a+=` id="${s}"`,a.trim()},h=(e,s,t)=>{let r="",o="";return l(e).forEach((i,l)=>{let c="";const d="option"===i.type?"select":i.type;if("select"===d&&o===d)return;o=d,s.question.checks&&(i=a({},i,{data:{checks:s.question.checks}}));const u=`${d}-${s.surveyId}-${s.question.id}-${"select"===d?l+1:i.id}`,p={questionNumber:s.question.index+1,wrapperClasses:t.cssClasses.wrapper[d]||t.cssClasses.wrapper.default,fieldAttributes:b(i,u,s.question.isRequired),fieldClasses:t.cssClasses[d]||t.cssClasses.default,answerType:d,answerCode:u,addMoreName:"",labelString:i.label||"",labelClasses:t.cssClasses.label};let m="";if(i.related){const e=i.related.type||"select",s="select"===e,r=s?a({},i):i.related;r.type=s?"option":e,r.id="",r.data=a({},r.data,{requiredFrom:"#"+u}),delete r.related;const o={fieldAttributes:b(r,"",!1),answerType:e,addMoreName:"-more",fieldClasses:s?t.cssClasses.select:t.cssClasses[e]||t.cssClasses.default};if(m=t.templates[e]||t.templates.input,s){const e=v(i.related);m=m.replace("{{optionsHtml}}",e)}m=n(o,m)}const f=((e,s)=>({field:s[e]||s.input,label:/^(checkbox|nested|radio|related)$/.test(e)?s.label:"",wrapper:s.wrapper[e]||s.wrapper.default}))(i.related?"related":i.nested?"nested":d,t.templates);let y="";i.nested&&(y=h(i.nested,s,t));let g="";"select"===d&&(g=v(e)),c=f.wrapper.replace("{{relatedFieldHTML}}",m).replace("{{fieldTemplate}}",f.field).replace("{{optionsHtml}}",g).replace("{{labelTemplate}}",f.label).replace("{{nestedFieldsHTML}}",y),r+=n(p,c)}),r},g=(e,s,t,a)=>{const o=s.getAttribute("name")||"";a.storageName=a.storageName.replace(/{{surveyId}}/,e.id),a.storageName=a.storageName.replace(/{{surveyFormName}}/,o);const i=((e,s,t)=>l(e).reduce((e,a,o)=>{if(a.external)return e;let i=t.templates.question;const l=a.id,c=o+1,d={surveyId:s,question:{id:l,index:o,isRequired:!!a.required}};a.checks&&(d.question.checks=a.checks);let u=h(a.answers,d,t);const p=a.checks?JSON.parse(a.checks):"",m=p[0]||"",f=p[1]||"",y=p&&t.messages.maxChoice?" ("+f+" "+t.messages.maxChoice+")":"",v={questionId:l,questionNumber:c,questionText:a.question+y,answersHTML:u,errorsHTML:t.fieldErrorFeedback?t.templates.wrapper.errors:""};if(i=n(v,i),t.fieldErrorFeedback){let e=""!==p?t.messages.errorMessageMultiChoice:a.errorMessage||t.messages.errorMessage;r(e)&&(e=""),i=i.replace(/{{errorTemplates}}/g,e)}return e+n({checksMin:m,checksMax:f},i)},""))(e.questions,e.id,t);s.querySelector("[data-surveyjs-body]").insertAdjacentHTML("beforeend",i);const c=e.questions.filter(e=>e.external)[0];if(c){const t=s.closest("[data-surveyjs-container]").querySelector("[data-surveyjs-external]");t.setAttribute("data-question-id",c.id),c.answers.forEach((s,r)=>{const a=t.querySelectorAll("[data-field]")[r],o={id:`${s.type}-${e.id}-${c.id}-${s.id}`,type:s.type,value:s.value,required:!!c.required};Object.keys(o).forEach(e=>{a[e]=o[e]});const i=a.closest("[data-answer]");i.querySelector("label").setAttribute("for",o.id),i.querySelector("[data-label]").innerHTML=s.label,t.querySelector("[data-question]").innerHTML=c.question})}};class j extends e{constructor(e,r={}){if(!r.url||"string"!=typeof r.url)throw new Error('"options.url" is missing or not a string!');const o=a({},j.prototype.options,r);c().isAvailable||(o.useWebStorage=!1),super(e,o);const i=this;i.internals=p,i.formEl.querySelector("[data-surveyjs-body]").insertAdjacentHTML("beforebegin",i.options.templates.loading);const n=((e=location.href,s={})=>{let t;if(s.headers=new Headers(s.headers),s.timeout>0){const e=new AbortController,r=e.signal;s.signal=r,t=window.setTimeout(()=>{e.abort()},s.timeout)}return fetch(e,s).then(e=>e.ok?e.json():Promise.reject(e)).catch(e=>Promise.reject(e)).finally(()=>{t&&window.clearTimeout(t)})})(i.options.url,i.options.initAjaxOptions).then(e=>"success"!==e.status.toLowerCase()?Promise.reject(e):new Promise(s=>{i.data=e.data,i.data.questions&&i.data.questions.length>0?(g(i.data,i.formEl,i.options,i.internals),i.options.useWebStorage&&((e,s)=>{const t=sessionStorage.getObject(s.storageName);if(t){const r=e.closest("[data-surveyjs-container]");s.storageArray=t,t.forEach(e=>{const s=r.querySelector('[name="'+e.name+'"]'),t=s.matches('[type="radio"], [type="checkbox"]'),a=t?r.querySelector('[name="'+e.name+'"][value="'+e.value+'"]'):s;t?a.checked=!0:a.value=e.value})}})(i.formEl,i.internals),t(i.data),i.formEl.addEventListener("fjs.field:validation",y),i.formEl.addEventListener("fjs.form:submit",m),super.init().then(()=>{i.isInitialized=!0,i.formEl.closest("[data-surveyjs-container]").classList.add("surveyjs-init-success"),s(e)})):s(e)})).finally(()=>{const e=i.formEl.querySelector("[data-surveyjs-loading]");e&&e.parentNode.removeChild(e)});((e,s,t={},r={})=>{r=a({},{bubbles:!0},r);const o=new Event(s,r);o.data=t,e.dispatchEvent(o)})(i.formEl,s,n)}destroy(){var e;(e=this.formEl).removeEventListener("fjs.field:validation",y),e.removeEventListener("fjs.form:submit",m),super.destroy()}static setOptions(e){j.prototype.options=a({},j.prototype.options,e)}}j.prototype.isInitialized=!1,j.prototype.options=u,j.prototype.version="3.0.0";export default j;
//# sourceMappingURL=surveyjs-esm.min.js.map
