/* surveyJS v4.0.0 | Valerio Di Punzio (@SimplySayHi) | https://www.valeriodipunzio.com/plugins/surveyJS/ | https://github.com/SimplySayHi/surveyJS | MIT license */
import e from"formjs-plugin";const s="sjs:destroy",t="sjs:init",r=e=>(Object.getOwnPropertyNames(e).forEach(s=>{const t=e[s];"object"==typeof t&&null!==t&&r(t)}),Object.freeze(e)),a=e=>"[object Object]"===Object.prototype.toString.call(e),o=function(e={}){return Array.from(arguments).slice(1).filter(e=>!!e).forEach(s=>{Object.keys(s).forEach(t=>{Array.isArray(s[t])?e[t]=(e[t]||[]).concat(s[t].slice(0)):a(s[t])?e[t]=o(e[t]||{},s[t]):Array.isArray(e[t])?e[t].push(s[t]):e[t]=s[t]})}),e},i=(e,s,t)=>{t=o({},{bubbles:!0},t);const r=new CustomEvent(s,t);e.dispatchEvent(r)},l=e=>{const s=e.closest("[data-question-id]");return s&&s.getAttribute("data-question-id")||""},n=e=>a(e)&&0===Object.getOwnPropertyNames(e).length,c=(e,s)=>Object.keys(e).reduce((s,t)=>{const r=new RegExp("{{"+t+"}}","g");return s.replace(r,e[t])},s),d=e=>(e[0].sort&&e.sort((e,s)=>e.sort>s.sort),e),u=()=>{const e=(()=>{const e="check_storage";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}})();return e&&(Storage.prototype.setObject=function(e,s){this.setItem(e,JSON.stringify(s))},Storage.prototype.getObject=function(e){const s=this.getItem(e);return s&&JSON.parse(s)}),{isAvailable:e}},p=(e,s)=>{const t=e.length;let r={};for(let a=0;a<t;a++){const t=e[a];if(t.id==s){r=t;break}}return r},m={cssClasses:{checkbox:"form-check-input",field:"form-control",file:"form-control-file",label:"form-check-label",radio:"form-check-input",wrapper:{checkbox:"form-check",field:"",radio:"form-check"}},formOptions:{getFormData:{formOptions:{getFormData:function(e,s){const t=this,r=t.$form,a=Array.from(r.closest("[data-surveyjs-wrapper]").querySelectorAll('[data-surveyjs-form] input:not([type="reset"]):not([type="submit"]):not([type="button"]), [data-surveyjs-form] select, [data-surveyjs-form] textarea, [data-surveyjs-external] [data-field]')),o={answers:[],id:t.data.id};let i="",c="";return a.forEach(e=>{const a=e.type,d=e.name;if(d===i&&a===c)return;e.matches("[data-required-from]")||(i=d,c=a);const u=l(e),m={question:u,answer:{value:s?e.value.trim():e.value||""}};if(!e.matches("[data-required-from]")&&""!==u&&!n(p(t.data.questions,u))){if("radio"===a){const s=(e.closest("form")?r:e.closest(t.options.fieldOptions.questionContainer)).querySelector('[name="'+d+'"]:checked');m.answer.value=s&&s.value||"",s&&s.matches("[data-require-more]")&&(m.answer.related=r.querySelector('[data-required-from="#'+s.id+'"]').value)}"checkbox"===a&&e.matches("[data-checks]")&&(m.answer.value=[],Array.from(r.querySelectorAll('[name="'+d+'"]:checked')).forEach(e=>{m.answer.value.push(e.value)})),o.answers.push(m)}}),o}}}.formOptions.getFormData},initAjaxOptions:{cache:"no-store",credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json"},method:"GET",mode:"same-origin",redirect:"follow",timeout:0},messages:{maxChoice:"answers max",error:"Answer is necessary.",errorMultiChoice:"You must choose from {{checksMin}} to {{checksMax}} answers."},showErrorMessage:!0,templates:{error:'<div class="surveyjs-error-message">{{errorMessage}}</div>',input:'<input {{fieldAttributes}} name="surveyjs-answer-{{questionNumber}}{{addMoreName}}" class="surveyjs-input surveyjs-{{answerType}} {{fieldClasses}}" />',label:'<label for="{{answerCode}}" class="surveyjs-label {{labelClasses}}">{{labelString}}</label>',loading:'<div class="surveyjs-loading" data-surveyjs-loading>Loading...</div>',select:'<select {{fieldAttributes}} name="surveyjs-answer-{{questionNumber}}{{addMoreName}}" class="surveyjs-select {{fieldClasses}}">{{optionsHtml}}</select>',textarea:'<textarea {{fieldAttributes}} name="surveyjs-answer-{{questionNumber}}" class="surveyjs-textarea {{fieldClasses}}"></textarea>',wrapper:{field:'<div class="surveyjs-field-wrapper surveyjs-{{answerType}}-wrapper {{wrapperClasses}}">{{fieldTemplate}}{{labelTemplate}}</div>',nested:'<div class="surveyjs-field-wrapper surveyjs-nested-wrapper">{{labelTemplate}}<div class="surveyjs-nested-inner">{{nestedFieldsHTML}}</div></div>',question:'<div class="surveyjs-question-wrapper" data-question-id="{{questionId}}" data-formjs-question><div class="surveyjs-question-text">{{questionText}}</div><div class="surveyjs-answers-wrapper">{{answersHTML}}</div><div class="surveyjs-errors-wrapper" data-surveyjs-errors>{{errorTemplates}}</div></div>',related:'<div class="surveyjs-field-wrapper surveyjs-related-wrapper input-group"><div class="input-group-prepend"><div class="surveyjs-radio-wrapper input-group-text form-check">{{fieldTemplate}}{{labelTemplate}}</div></div>{{relatedFieldHTML}}</div>'}},useWebStorage:!0},f={storageName:"Survey_"+location.href+"_{{surveyFormName}}_surveyId[{{surveyId}}]"};function y(e){const s=e.target.surveyjs;e.detail.then(()=>{s.options.useWebStorage&&sessionStorage.removeItem(s.internals.storageName)})}const v=(e,s,t="")=>{const r=e.length;for(let a=0;a<r;a++){const r=e[a];if(r.name===s){if(t&&r.value!==t)continue;return a}}return-1};function h(e){const s=e.detail.$field,t=e.detail.errors,r=s.closest("form").surveyjs,a=r.options,o=s.closest(a.fieldOptions.questionContainer).querySelector("[data-surveyjs-errors]"),i=l(s),c=p(r.data.questions,i);if(n(c))return!0;if(o&&t&&isPlainObject(c.errorMessage)){let e=Object.keys(t);if(t.rule){const s=e.indexOf("rule");u=s,m=0,(d=e).splice(m,0,d.splice(u,1)[0]),e=d}const s=e.reduce((e,s)=>{const t=c.errorMessage[s]||"";return e+(t?a.templates.error.replace("{{errorMessage}}",t):"")},"");o.innerHTML=s}var d,u,m;if(!e.detail.isCheckingForm&&a.useWebStorage&&!s.matches("[data-exclude-storage]")){const e=r.internals.storageName;let t=sessionStorage.getObject(e)||[];const a=s.name,o=s.value,i=s.matches("[data-required-from]"),l=s.matches("[data-checks]"),n=s.matches("[data-require-more]"),c=i?document.querySelector(s.getAttribute("data-required-from")):null,d=v(t,a+"-more");!n&&!i&&d>=0&&t.splice(d,1);const u=v(t,a,!!l&&o);if(u>=0)t.splice(u,1),(l&&s.checked||!l&&""!==o)&&t.push({name:a,value:o});else if(""!==o){if(i){const e=v(t,c.name);e>=0&&t.splice(e,1),t.push({name:c.name,value:c.value})}t.push({name:a,value:o})}sessionStorage.setObject(e,t)}!c.required||s.required||s.matches("[data-required-from]")||(s.required=!0,r.validateField(s))}const b=(e=[])=>d(e).reduce((e,s)=>e+`<option value="${s.value}">${s.label}</option>`,""),g=(e,s,t)=>{const r=["data","id","label","nested","related","sort"];/^(option|textarea)$/.test(e.type)&&r.push("type","value");let a="";return Object.keys(e).filter(e=>-1===r.indexOf(e)).forEach(s=>{a+=` ${s}="${e[s]}"`}),e.data&&Object.keys(e.data).forEach(s=>{a+=` data-${((e="",s=!1)=>{let t=e.trim().replace(/(([_ ])([a-z]))|(([a-z])?([A-Z]))/g,(e,s,t,r,a,o,i)=>(r?"-"+r:(o||"")+"-"+i).toLowerCase());return s?t.toUpperCase():t})(s)}="${e.data[s]}"`}),t&&(a+=" required"),e.related&&(a+=" data-require-more"),a+=` id="${s}"`,a.trim()},j=(e,s,t)=>{let r="",a="";return d(e).forEach((i,l)=>{let n="";const d="option"===i.type?"select":i.type;if("select"===d&&a===d)return;a=d,s.question.checks&&(i=o({},i,{data:{checks:s.question.checks}}));const u=`${d}-${s.surveyId}-${s.question.id}-${"select"===d?l+1:i.id}`,p={questionNumber:s.question.index+1,wrapperClasses:t.cssClasses.wrapper[d]||t.cssClasses.wrapper.field,fieldAttributes:g(i,u,s.question.isRequired),fieldClasses:t.cssClasses[d]||t.cssClasses.field,answerType:d,answerCode:u,addMoreName:"",labelString:i.label||"",labelClasses:t.cssClasses.label};let m="";if(i.related){const e=i.related.type||"select",s="select"===e,r=s?o({},i):i.related;r.type=s?"option":e,r.id="",r.data=o({},r.data,{requiredFrom:"#"+u}),delete r.related;const a={fieldAttributes:g(r,"",!1),answerType:e,addMoreName:"-more",fieldClasses:s?t.cssClasses.select:t.cssClasses[e]||t.cssClasses.field};if(m=t.templates[e]||t.templates.input,s){const e=b(i.related);m=m.replace("{{optionsHtml}}",e)}m=c(a,m)}const f=((e,s)=>({field:s[e]||s.input,label:/^(checkbox|nested|radio|related)$/.test(e)?s.label:"",wrapper:s.wrapper[e]||s.wrapper.field}))(i.related?"related":i.nested?"nested":d,t.templates);let y="";i.nested&&(y=j(i.nested,s,t));let v="";"select"===d&&(v=b(e)),n=f.wrapper.replace("{{relatedFieldHTML}}",m).replace("{{fieldTemplate}}",f.field).replace("{{optionsHtml}}",v).replace("{{labelTemplate}}",f.label).replace("{{nestedFieldsHTML}}",y),r+=c(p,n)}),r},q=(e,s,t)=>{const r=((e,s,t)=>d(e).reduce((e,r,o)=>{if(r.external)return e;let i=t.templates.wrapper.question;const l=r.id,n=o+1,d={surveyId:s,question:{id:l,index:o,isRequired:!!r.required}};r.checks&&(d.question.checks=r.checks);const u=j(r.answers,d,t),p=r.checks?JSON.parse(r.checks):"",m=p[0]||"",f=p[1]||"",y=p&&t.messages.maxChoice?" ("+f+" "+t.messages.maxChoice+")":"",v={questionId:l,questionNumber:n,questionText:r.question+y,answersHTML:u};if(i=c(v,i),t.showErrorMessage){let e=""!==p?t.messages.errorMultiChoice:r.errorMessage||t.messages.error;a(e)&&(e=""),i=i.replace(/{{errorTemplates}}/g,e)}return e+c({checksMin:m,checksMax:f},i)},""))(e.questions,e.id,t);s.querySelector("[data-surveyjs-body]").insertAdjacentHTML("beforeend",r);const o=e.questions.filter(e=>e.external);if(o.length>0){const t=s.closest("[data-surveyjs-wrapper]");o.forEach((s,r)=>{const a=t.querySelector('[data-surveyjs-external="'+(r+1)+'"]');a.setAttribute("data-question-id",s.id),s.answers.forEach((t,r)=>{const o=a.querySelectorAll("[data-field]")[r],i={id:`${t.type}-${e.id}-${s.id}-${t.id}`,type:t.type,value:t.value,required:!!s.required};Object.keys(i).forEach(e=>{o[e]=i[e]});const l=o.closest("[data-answer]");l.querySelector("label").setAttribute("for",i.id),l.querySelector("[data-label]").innerHTML=t.label,a.querySelector("[data-question]").innerHTML=s.question})})}};class w extends e{constructor(e,s={}){if(!s.url||"string"!=typeof s.url)throw new Error('"options.url" is missing or not a string!');s=o({},w.prototype.options,s),u().isAvailable||(s.useWebStorage=!1),super(e,s);const a=this;a.internals=f;const l=a.$form;s=a.options;const n=a.internals;l.surveyjs=a,l.querySelector("[data-surveyjs-body]").insertAdjacentHTML("beforebegin",s.templates.loading);const c=((e=location.href,s={})=>{let t;if(s.headers=new Headers(s.headers),s.timeout>0){const e=new AbortController,r=e.signal;s.signal=r,t=window.setTimeout(()=>{e.abort()},s.timeout)}return fetch(e,s).then(e=>{if(!e.ok)throw new Error(e.statusText);return e.json()}).catch(e=>{throw new Error(e.message)}).finally(()=>{t&&window.clearTimeout(t)})})(s.url,s.initAjaxOptions).then(e=>"success"!==e.status.toLowerCase()?Promise.reject(e):e.data.questions&&e.data.questions.length>0?(n.storageName=n.storageName.replace(/{{surveyId}}/,e.data.id),n.storageName=n.storageName.replace(/{{surveyFormName}}/,l.getAttribute("name")||""),q(e.data,l,s),s.useWebStorage&&((e,s)=>{const t=sessionStorage.getObject(s.storageName);if(t){const s=e.closest("[data-surveyjs-wrapper]");t.forEach(e=>{const t=s.querySelector('[name="'+e.name+'"]'),r=t.matches('[type="radio"], [type="checkbox"]'),a=r?s.querySelector('[name="'+e.name+'"][value="'+e.value+'"]'):t;r?a.checked=!0:a.value=e.value})}})(l,n),Object.defineProperty(a,"data",{value:r(e.data)}),l.addEventListener("fjs.field:validation",h),l.addEventListener("fjs.form:submit",y),l.closest("[data-surveyjs-wrapper]").classList.add("surveyjs-init-success"),super.validateFilledFields().then(s=>(a.isInitialized=!0,l.closest("[data-surveyjs-wrapper]").classList.add("surveyjs-init-success"),e))):e).finally(()=>{const e=l.querySelector("[data-surveyjs-loading]");e&&e.parentNode.removeChild(e)});i(l,t,{detail:c})}destroy(){var e;super.destroy(),(e=this.$form).removeEventListener("fjs.field:validation",h),e.removeEventListener("fjs.form:submit",y),delete e.surveyjs,i(this.$form,s)}static setOptions(e){w.prototype.options=o({},w.prototype.options,e)}}w.prototype.isInitialized=!1,w.prototype.options=m,w.prototype.version="4.0.0";export default w;
//# sourceMappingURL=surveyjs-esm.min.js.map
