/* surveyJS v3.0.2 | Valerio Di Punzio (@SimplySayHi) | https://www.valeriodipunzio.com/plugins/surveyJS/ | https://github.com/SimplySayHi/surveyJS | MIT license */
import e from"formjs-plugin";const t="sjs:init",s=e=>(Object.getOwnPropertyNames(e).forEach(t=>{const r=e[t];"object"==typeof r&&null!==r&&s(r)}),Object.freeze(e)),r=e=>"[object Object]"===Object.prototype.toString.call(e),a=function(e={}){return Array.from(arguments).slice(1).filter(e=>!!e).forEach(t=>{Object.keys(t).forEach(s=>{Array.isArray(t[s])?e[s]=(e[s]||[]).concat(t[s].slice(0)):r(t[s])?e[s]=a(e[s]||{},t[s]):Array.isArray(e[s])?e[s].push(t[s]):e[s]=t[s]})}),e},o=e=>{const t=e.closest("[data-question-id]");return t&&t.getAttribute("data-question-id")||""},i=e=>r(e)&&0===Object.getOwnPropertyNames(e).length,n=(e,t)=>Object.keys(e).reduce((t,s)=>{const r=new RegExp("{{"+s+"}}","g");return t.replace(r,e[s])},t),l=e=>(e[0].sort&&e.sort((e,t)=>e.sort>t.sort),e),c=()=>{const e=(()=>{const e="check_storage";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}})();return e&&(Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t))},Storage.prototype.getObject=function(e){const t=this.getItem(e);return t&&JSON.parse(t)}),{isAvailable:e}},d=(e,t)=>{const s=e.length;let r={};for(let a=0;a<s;a++){const s=e[a];if(s.id==t){r=s;break}}return r},u={cssClasses:{checkbox:"form-check-input",field:"form-control",file:"form-control-file",label:"form-check-label",radio:"form-check-input",wrapper:{checkbox:"form-check",field:"",radio:"form-check"}},formOptions:{getFormData:{formOptions:{getFormData:function(){const e=this,t=e.formEl,s=Array.from(t.closest("[data-surveyjs-wrapper]").querySelectorAll('[data-surveyjs-form] input:not([type="reset"]):not([type="submit"]):not([type="button"]), [data-surveyjs-form] select, [data-surveyjs-form] textarea, [data-surveyjs-external] [data-field]')),r={answers:[],id:e.data.id};let a="",n="";return s.forEach(s=>{const l=s.type,c=s.name;if(c===a&&l===n)return;s.matches("[data-required-from]")||(a=c,n=l);const u=o(s),p={question:u,answer:{value:s.value||""}};if(!s.matches("[data-required-from]")&&""!==u&&!i(d(e.data.questions,u))){if("radio"===l){const r=(s.closest("form")?t:s.closest(e.options.fieldOptions.questionContainer)).querySelector('[name="'+c+'"]:checked');p.answer.value=r&&r.value||"",r&&r.matches("[data-require-more]")&&(p.answer.related=t.querySelector('[data-required-from="#'+r.id+'"]').value)}"checkbox"===l&&s.matches("[data-checks]")&&(p.answer.value=[],Array.from(t.querySelectorAll('[name="'+c+'"]:checked')).forEach(e=>{p.answer.value.push(e.value)})),r.answers.push(p)}}),r}}}.formOptions.getFormData},initAjaxOptions:{cache:"no-store",credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json"},method:"GET",mode:"same-origin",redirect:"follow",timeout:0},messages:{maxChoice:"answers max",error:"Answer is necessary.",errorMultiChoice:"You must choose from {{checksMin}} to {{checksMax}} answers."},showErrorMessage:!0,templates:{error:'<div class="surveyjs-error-message">{{errorMessage}}</div>',input:'<input {{fieldAttributes}} name="surveyjs-answer-{{questionNumber}}{{addMoreName}}" class="surveyjs-input surveyjs-{{answerType}} {{fieldClasses}}" />',label:'<label for="{{answerCode}}" class="surveyjs-label {{labelClasses}}">{{labelString}}</label>',loading:'<div class="surveyjs-loading" data-surveyjs-loading>Loading...</div>',select:'<select {{fieldAttributes}} name="surveyjs-answer-{{questionNumber}}{{addMoreName}}" class="surveyjs-select {{fieldClasses}}">{{optionsHtml}}</select>',textarea:'<textarea {{fieldAttributes}} name="surveyjs-answer-{{questionNumber}}" class="surveyjs-textarea {{fieldClasses}}"></textarea>',wrapper:{field:'<div class="surveyjs-field-wrapper surveyjs-{{answerType}}-wrapper {{wrapperClasses}}">{{fieldTemplate}}{{labelTemplate}}</div>',nested:'<div class="surveyjs-field-wrapper surveyjs-nested-wrapper">{{labelTemplate}}<div class="surveyjs-nested-inner">{{nestedFieldsHTML}}</div></div>',question:'<div class="surveyjs-question-wrapper" data-question-id="{{questionId}}" data-formjs-question><div class="surveyjs-question-text">{{questionText}}</div><div class="surveyjs-answers-wrapper">{{answersHTML}}</div><div class="surveyjs-errors-wrapper" data-surveyjs-errors>{{errorTemplates}}</div></div>',related:'<div class="surveyjs-field-wrapper surveyjs-related-wrapper input-group"><div class="input-group-prepend"><div class="surveyjs-radio-wrapper input-group-text form-check">{{fieldTemplate}}{{labelTemplate}}</div></div>{{relatedFieldHTML}}</div>'}},useWebStorage:!0},p={storageName:"Survey_"+location.href+"_{{surveyFormName}}_surveyId[{{surveyId}}]"};function m(e){const t=e.target.formjs;e.data.then(()=>{t.options.useWebStorage&&sessionStorage.removeItem(t.internals.storageName)})}const f=(e,t,s="")=>{const r=e.length;for(let a=0;a<r;a++){const r=e[a];if(r.name===t){if(s&&r.value!==s)continue;return a}}return-1};function y(e){const t=e.data.fieldEl,s=e.data.errors,r=t.closest("form").formjs,a=r.options,n=t.closest(a.fieldOptions.questionContainer).querySelector("[data-surveyjs-errors]"),l=o(t),c=d(r.data.questions,l);if(i(c))return!0;if(n&&s&&isPlainObject(c.errorMessage)){let e=Object.keys(s);if(s.rule){const t=e.indexOf("rule");p=t,m=0,(u=e).splice(m,0,u.splice(p,1)[0]),e=u}const t=e.reduce((e,t)=>{const s=c.errorMessage[t]||"";return e+(s?a.templates.error.replace("{{errorMessage}}",s):"")},"");n.innerHTML=t}var u,p,m;if(!e.data.isCheckingForm&&a.useWebStorage&&!t.matches("[data-exclude-storage]")){const e=r.internals.storageName;let s=sessionStorage.getObject(e)||[];const a=t.name,o=t.value,i=t.matches("[data-required-from]"),n=t.matches("[data-checks]"),l=t.matches("[data-require-more]"),c=i?document.querySelector(t.getAttribute("data-required-from")):null,d=f(s,a+"-more");!l&&!i&&d>=0&&s.splice(d,1);const u=f(s,a,!!n&&o);if(u>=0)s.splice(u,1),(n&&t.checked||!n&&""!==o)&&s.push({name:a,value:o});else if(""!==o){if(i){const e=f(s,c.name);e>=0&&s.splice(e,1),s.push({name:c.name,value:c.value})}s.push({name:a,value:o})}sessionStorage.setObject(e,s)}!c.required||t.required||t.matches("[data-required-from]")||(t.required=!0,r.validateField(t))}const v=(e=[])=>l(e).reduce((e,t)=>e+`<option value="${t.value}">${t.label}</option>`,""),h=(e,t,s)=>{const r=["data","id","label","nested","related","sort"];/^(option|textarea)$/.test(e.type)&&r.push("type","value");let a="";return Object.keys(e).filter(e=>-1===r.indexOf(e)).forEach(t=>{a+=` ${t}="${e[t]}"`}),e.data&&Object.keys(e.data).forEach(t=>{a+=` data-${((e="",t=!1)=>{let s=e.trim().replace(/(([_ ])([a-z]))|(([a-z])?([A-Z]))/g,(e,t,s,r,a,o,i)=>(r?"-"+r:(o||"")+"-"+i).toLowerCase());return t?s.toUpperCase():s})(t)}="${e.data[t]}"`}),s&&(a+=" required"),e.related&&(a+=" data-require-more"),a+=` id="${t}"`,a.trim()},b=(e,t,s)=>{let r="",o="";return l(e).forEach((i,l)=>{let c="";const d="option"===i.type?"select":i.type;if("select"===d&&o===d)return;o=d,t.question.checks&&(i=a({},i,{data:{checks:t.question.checks}}));const u=`${d}-${t.surveyId}-${t.question.id}-${"select"===d?l+1:i.id}`,p={questionNumber:t.question.index+1,wrapperClasses:s.cssClasses.wrapper[d]||s.cssClasses.wrapper.field,fieldAttributes:h(i,u,t.question.isRequired),fieldClasses:s.cssClasses[d]||s.cssClasses.field,answerType:d,answerCode:u,addMoreName:"",labelString:i.label||"",labelClasses:s.cssClasses.label};let m="";if(i.related){const e=i.related.type||"select",t="select"===e,r=t?a({},i):i.related;r.type=t?"option":e,r.id="",r.data=a({},r.data,{requiredFrom:"#"+u}),delete r.related;const o={fieldAttributes:h(r,"",!1),answerType:e,addMoreName:"-more",fieldClasses:t?s.cssClasses.select:s.cssClasses[e]||s.cssClasses.field};if(m=s.templates[e]||s.templates.input,t){const e=v(i.related);m=m.replace("{{optionsHtml}}",e)}m=n(o,m)}const f=((e,t)=>({field:t[e]||t.input,label:/^(checkbox|nested|radio|related)$/.test(e)?t.label:"",wrapper:t.wrapper[e]||t.wrapper.field}))(i.related?"related":i.nested?"nested":d,s.templates);let y="";i.nested&&(y=b(i.nested,t,s));let g="";"select"===d&&(g=v(e)),c=f.wrapper.replace("{{relatedFieldHTML}}",m).replace("{{fieldTemplate}}",f.field).replace("{{optionsHtml}}",g).replace("{{labelTemplate}}",f.label).replace("{{nestedFieldsHTML}}",y),r+=n(p,c)}),r},g=(e,t,s)=>{const a=((e,t,s)=>l(e).reduce((e,a,o)=>{if(a.external)return e;let i=s.templates.wrapper.question;const l=a.id,c=o+1,d={surveyId:t,question:{id:l,index:o,isRequired:!!a.required}};a.checks&&(d.question.checks=a.checks);const u=b(a.answers,d,s),p=a.checks?JSON.parse(a.checks):"",m=p[0]||"",f=p[1]||"",y=p&&s.messages.maxChoice?" ("+f+" "+s.messages.maxChoice+")":"",v={questionId:l,questionNumber:c,questionText:a.question+y,answersHTML:u};if(i=n(v,i),s.showErrorMessage){let e=""!==p?s.messages.errorMultiChoice:a.errorMessage||s.messages.error;r(e)&&(e=""),i=i.replace(/{{errorTemplates}}/g,e)}return e+n({checksMin:m,checksMax:f},i)},""))(e.questions,e.id,s);t.querySelector("[data-surveyjs-body]").insertAdjacentHTML("beforeend",a);const o=e.questions.filter(e=>e.external);if(o.length>0){const s=t.closest("[data-surveyjs-wrapper]");o.forEach((t,r)=>{const a=s.querySelector('[data-surveyjs-external="'+(r+1)+'"]');a.setAttribute("data-question-id",t.id),t.answers.forEach((s,r)=>{const o=a.querySelectorAll("[data-field]")[r],i={id:`${s.type}-${e.id}-${t.id}-${s.id}`,type:s.type,value:s.value,required:!!t.required};Object.keys(i).forEach(e=>{o[e]=i[e]});const n=o.closest("[data-answer]");n.querySelector("label").setAttribute("for",i.id),n.querySelector("[data-label]").innerHTML=s.label,a.querySelector("[data-question]").innerHTML=t.question})})}};class j extends e{constructor(e,r={}){if(!r.url||"string"!=typeof r.url)throw new Error('"options.url" is missing or not a string!');r=a({},j.prototype.options,r),c().isAvailable||(r.useWebStorage=!1),super(e,r);const o=this;o.internals=p,e=o.formEl,r=o.options;const i=o.internals;e.querySelector("[data-surveyjs-body]").insertAdjacentHTML("beforebegin",r.templates.loading);const n=((e=location.href,t={})=>{let s;if(t.headers=new Headers(t.headers),t.timeout>0){const e=new AbortController,r=e.signal;t.signal=r,s=window.setTimeout(()=>{e.abort()},t.timeout)}return fetch(e,t).then(e=>{if(!e.ok)throw new Error(e.statusText);return e.json()}).catch(e=>{throw new Error(e.message)}).finally(()=>{s&&window.clearTimeout(s)})})(r.url,r.initAjaxOptions).then(t=>"success"!==t.status.toLowerCase()?Promise.reject(t):new Promise(a=>{t.data.questions&&t.data.questions.length>0?(i.storageName=i.storageName.replace(/{{surveyId}}/,t.data.id),i.storageName=i.storageName.replace(/{{surveyFormName}}/,e.getAttribute("name")||""),g(t.data,e,r),r.useWebStorage&&((e,t)=>{const s=sessionStorage.getObject(t.storageName);if(s){const t=e.closest("[data-surveyjs-wrapper]");s.forEach(e=>{const s=t.querySelector('[name="'+e.name+'"]'),r=s.matches('[type="radio"], [type="checkbox"]'),a=r?t.querySelector('[name="'+e.name+'"][value="'+e.value+'"]'):s;r?a.checked=!0:a.value=e.value})}})(e,i),Object.defineProperty(o,"data",{value:s(t.data)}),e.addEventListener("fjs.field:validation",y),e.addEventListener("fjs.form:submit",m),super.init().then(()=>{o.isInitialized=!0,e.closest("[data-surveyjs-wrapper]").classList.add("surveyjs-init-success"),a(t)})):a(t)})).finally(()=>{const t=e.querySelector("[data-surveyjs-loading]");t&&t.parentNode.removeChild(t)});((e,t,s={},r={})=>{r=a({},{bubbles:!0},r);const o=new Event(t,r);o.data=s,e.dispatchEvent(o)})(e,t,n)}destroy(){var e;(e=this.formEl).removeEventListener("fjs.field:validation",y),e.removeEventListener("fjs.form:submit",m),super.destroy()}static setOptions(e){j.prototype.options=a({},j.prototype.options,e)}}j.prototype.isInitialized=!1,j.prototype.options=u,j.prototype.version="3.0.2";export default j;
//# sourceMappingURL=surveyjs-esm.min.js.map
