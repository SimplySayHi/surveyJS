/* surveyJS v3.0.0 | Valerio Di Punzio (@SimplySayHi) | https://www.valeriodipunzio.com/plugins/surveyJS/ | https://github.com/SimplySayHi/surveyJS | MIT license */
import e from"formjs-plugin";const t="sjs:init",s=e=>(Object.getOwnPropertyNames(e).forEach(t=>{const a=e[t];"object"==typeof a&&null!==a&&s(a)}),Object.freeze(e)),a=e=>"[object Object]"===Object.prototype.toString.call(e),r=function(e={}){return Array.from(arguments).slice(1).filter(e=>!!e).forEach(t=>{Object.keys(t).forEach(s=>{Array.isArray(t[s])?e[s]=(e[s]||[]).concat(t[s].slice(0)):a(t[s])?e[s]=r(e[s]||{},t[s]):Array.isArray(e[s])?e[s].push(t[s]):e[s]=t[s]})}),e},o='[data-surveyjs-form] input:not([type="reset"]):not([type="submit"]):not([type="button"]), [data-surveyjs-form] select, [data-surveyjs-form] textarea, [data-name="bind-surveyjs-answer"]',n=e=>a(e)&&0===Object.getOwnPropertyNames(e).length,i=()=>{const e=(()=>{const e="check_storage";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}})();return e&&(Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t))},Storage.prototype.getObject=function(e){const t=this.getItem(e);return t&&JSON.parse(t)}),{isAvailable:e}},l=(e,t)=>{const s=e.questions,a=s.length;let r={};for(let e=0;e<a;e++){const a=s[e];if(a.id==t){r=a;break}}return r},d={formOptions:{beforeSend:function(e){let t=!1;const s=this,a=s.formEl.closest("[data-surveyjs-container]"),n=Array.from(a.querySelectorAll(o));let i="",d="";if(n.forEach(e=>{const a=e.type,r=e.name;if(r===i&&a===d)return;e.matches("[data-required-from]")||(i=r,d=a);const o=e.closest("[data-question-id]"),n=o?o.getAttribute("data-question-id"):"",c=l(s.data,n);if(""!==n&&c&&void 0!==c.required){const s=e.matches("[data-required-from]"),a=document.querySelector(e.getAttribute("data-required-from"));(!s||s&&a.checked)&&(e.required||(t=!0),e.required=!0)}}),t){const t=r({},s.options.fieldOptions,{focusOnRelated:!1});return s.validateForm(t).then(t=>(e.stopExecution=!0,e))}return e},getFormData:function(){const e=this.formEl,t=e.formjs,s=Array.from(e.closest("[data-surveyjs-container]").querySelectorAll(o)),a={answers:[],id:t.data.id};let r="",i="";return s.forEach(s=>{const o=s.type,d=s.name;if(d===r&&o===i)return;s.matches("[data-required-from]")||(r=d,i=o);const c=s.closest("[data-question-id]"),u=c?c.getAttribute("data-question-id"):"",p=s.value,m={question:u,answer:{id_answer:[p]}};if(!s.matches("[data-required-from]")&&""!==u&&!n(l(t.data,u))){if(s.matches("textarea")&&(m.answer.id_answer=[""],m.answer.text=p),"radio"===o){const t=(s.closest("form")?e:s.closest("[data-formjs-question]")).querySelector('[name="'+d+'"]:checked');t?(t.matches("[data-require-more]")&&(m.answer.attributes=e.querySelector('[data-required-from="#'+t.id+'"]').value.trim()),t.matches("[data-nested-index]")&&(m.answer.attributes=t.getAttribute("data-nested-index")),m.answer.id_answer=[t.value.trim()]):m.answer.id_answer=[""]}"checkbox"===o&&s.matches("[data-checks]")&&(m.answer.id_answer=[],Array.from(e.querySelectorAll('[name="'+d+'"]:checked')).forEach(e=>{m.answer.id_answer.push(e.value.trim())})),a.answers.push(m)}}),a}}},c={cssClasses:{checkbox:"form-check-input",default:"form-control",file:"form-control-file",label:"form-check-label",radio:"form-check-input",select:"form-control",textarea:"form-control"},fieldErrorFeedback:!0,formOptions:{beforeSend:[d.formOptions.beforeSend],getFormData:d.formOptions.getFormData},initAjaxOptions:{cache:"no-store",credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json"},method:"GET",mode:"same-origin",redirect:"follow",timeout:0},lang:"en",templates:{fieldError:'<div class="surveyjs-field-error-message">{{fieldErrorMessage}}</div>',input:'<div class="surveyjs-single-answer surveyjs-input-container surveyjs-answer-{{answerType}} form-check" data-answer-index="{{answerIndex}}">{{inputTagCode}}{{labelTagCode}}</div>',inputGroup:'<div class="surveyjs-single-answer input-group" data-answer-index="{{answerIndex}}"><div class="input-group-prepend"><div class="input-group-text form-check surveyjs-answer-{{answerType}}"><input type="{{answerType}}" name="surveyjs-answer-{{questionNumber}}" id="{{answerCode}}" data-answer-id="{{answerId}}" value="{{answerIdValue}}" {{attrRequired}} data-require-more="" class="surveyjs-input surveyjs-radio form-check-input" /><label for="{{answerCode}}" class="surveyjs-label form-check-label">{{answerString}}</label></div></div>{{relatedAnswerField}}</div>',inputTag:'<input type="{{answerType}}" {{attrSubtype}} name="surveyjs-answer-{{questionNumber}}{{addMoreName}}" class="surveyjs-input surveyjs-{{answerType}} {{fieldClass}}" id="{{answerCode}}" {{nestedAnswer}} data-answer-root="{{progIdsJoined}}" data-answer-id="{{answerId}}" value="{{answerIdValue}}" {{attrRequired}} {{validateIfFilled}} {{attrChecks}} {{attrRequiredFrom}} />',labelTag:'<label for="{{answerCode}}" class="surveyjs-label {{labelClass}}">{{answerString}}</label>',question:'<div data-question-id="{{questionId}}" data-question-index="{{questionNumber}}" data-formjs-question class="surveyjs-question-box clearfix"><div class="surveyjs-question-header">Question {{questionNumber}}</div><div class="surveyjs-question-body"><div class="surveyjs-question-text">{{questionText}}</div><div class="surveyjs-answers-box form-group clearfix">{{answersHtml}}{{fieldErrorTemplate}}</div></div></div>',select:'<div class="surveyjs-single-answer surveyjs-answer-select" data-answer-index="{{answerIndex}}">{{selectTagCode}}</div>',selectTag:'<select id="{{answerCode}}" name="surveyjs-answer-{{questionNumber}}{{addMoreName}}" class="surveyjs-select {{fieldClass}}" {{attrRequired}} {{nestedAnswer}} data-answer-root="{{progIdsJoined}}" {{attrRequiredFrom}}>{{optionsHtml}}</select>',textarea:'<div class="surveyjs-single-answer surveyjs-answer-textarea"><textarea id="{{answerCode}}" data-answer-id="{{answerId}}" {{nestedAnswer}} name="surveyjs-answer-{{questionNumber}}" {{attrRequired}} class="surveyjs-textarea {{fieldClass}}" {{answerMaxlength}} rows="6" placeholder="{{answerPlaceholder}}"></textarea></div>'},useLocalStorage:!0},u={storageArray:[],storageName:"Survey_"+location.href+"_{{surveyFormName}}_surveyId[{{surveyId}}]"},p=(e,t,s="")=>{const a=localStorage.getObject(e.storageName);if(a){const e=a.length;for(let r=0;r<e;r++){const e=a[r];if(e.field===t){if(s&&e.value!==s)continue;return r}}}return-1},m=function(e){const t=e.type,s=e.target,a=s.closest("form").formjs,r=a.internals,o=s.closest("[data-formjs-question]"),i=s.value?s.value.trim():s.value,d=s.matches("[data-checks]"),c=s.matches("[data-require-more]"),u=s.matches("[data-required-from]"),m=u?o.querySelector(s.getAttribute("data-required-from")):null,f=u?m:s,g=f.id?f.id.split("-")[1]:"id-not-found",y=(e=>e.matches('select, [type="radio"], [type="checkbox"], [type="file"]'))(s),v=l(a.data,g);if(n(v))return!0;if(y&&"change"===t||!y&&"change"!==t){if(a.options.useLocalStorage&&!s.matches("[data-exclude-storage]")){const e=p(r,s.name,!!d&&i),t=p(r,s.name+"-more");let a=r.storageArray;if(c||u||-1===t||a.splice(t,1),-1!==e)d?s.checked||a[e].value!==i?a.push({field:s.name,value:i}):a.splice(e,1):""!==i?a[e].value=i:a.splice(e,1);else if(""!==i){if(u&&""!==i){const e=p(r,m.name);-1!==e&&a.splice(e,1),a.push({field:m.name,value:m.value.trim()})}if(a.push({field:s.name,value:i}),c){const e=s.closest("form").querySelector('[data-required-from="#'+s.id+'"]');a.push({field:e.name,value:e.value.trim()})}}localStorage.setObject(r.storageName,a)}void 0!==v.required&&(s.required=!0)}},f=(e=[],t)=>{let s=""===e[0].id?"":'<option value="">'+t.selectFirstOption+"</option>";return e.forEach(e=>{s+='<option value="'+e.id+'" data-answer-id="'+e.id+'">'+e.answer+"</option>"}),s},g={attribute:(e,t)=>{const s=t.objData,a=e.templates.inputGroup,r=t.answer.attribute,o=Array.isArray(r),n=o?e.templates.selectTag:e.templates.inputTag;return s.fieldClass=e.cssClasses.default,o&&(s.fieldClass=e.cssClasses.select,s.optionsHtml=f(r,e)),{aHtml:a,relatedAnswerField:n,objData:s}},input:(e,t)=>{const s=t.objData,a=t.beforeCode+e.templates.input+t.afterCode;return"checkbox"!==s.answerType&&"radio"!==s.answerType&&(s.nestedAnswer+=' class="'+s.fieldClass+'"'),{aHtml:a,objData:s}},nested:(e,t)=>{const s=t.objData;let a=e.templates.labelTag;a=a.replace(/{{answerCode}}/g,s.answerCode),a=a.replace(/{{labelClass}}/g,e.cssClasses.label+" surveyjs-field-indent-0"),a=a.replace(/{{answerString}}/g,t.answer.answer);return{aHtml:t.beforeCode+'<div class="surveyjs-'+s.answerType+'">'+a+"</div>"+t.afterCode,objData:s}},select:(e,t)=>{const s=t.objData,a=t.beforeCode+e.templates.select+t.afterCode;return s.optionsHtml=f(t.obj.answers,e),{aHtml:a,objData:s}},textarea:(e,t)=>{const s=t.objData,a=e.templates.textarea;return s.answerPlaceholder=t.answer.placeholder||e.textareaPlaceholder,{aHtml:a,objData:s}}},y=(e,t,s)=>{if(""!==s.optionsHtml&&(t.aHtml=t.aHtml.replace(/{{selectTagCode}}/g,e.templates.selectTag)),t.relatedAnswerField){const e={answerCode:"",answerType:"text",fieldClass:s.fieldClass,answerIdValue:"",attrRequired:"",addMoreName:"-more",attrRequiredFrom:'data-required-from="#'+s.answerCode+'"'};for(let s in e){const a=new RegExp("{{"+s+"}}","g");t.relatedAnswerField=t.relatedAnswerField.replace(a,e[s])}t.aHtml=t.aHtml.replace(/{{relatedAnswerField}}/g,t.relatedAnswerField)}else t.aHtml=t.aHtml.replace(/{{addMoreName}}/g,""),t.aHtml=t.aHtml.replace(/{{attrRequiredFrom}}/g,"");for(let e in s){const a=new RegExp("{{"+e+"}}","g");t.aHtml=t.aHtml.replace(a,s[e])}return t.aHtml};let v=[];const w=(e,t,s,a,r,o)=>{a=s.id?s.id:a||0;let n=Array.isArray(s)?s:s.answers,i=n.length,l=r||0,d="";const c="hidden-privacy"===s.question;n[0].sort&&n.sort((e,t)=>e.sort>t.sort);for(let r=0;r<i;r++){let u=n[r],p=r+1,m=l+1,f=u.type,h=u.id,b=v.length,j=b>0?v.join("-"):"",q=()=>{let e="option"===u.type?"select":u.type;return t.cssClasses[e]||t.cssClasses.default},x={aHtml:""},C={labelTagCode:"checkbox"===f||"radio"===f?t.templates.labelTag:"",answerId:h,answerIdValue:"text"===f?"":h,answerIndex:p,answerName:"surveyjs-answer-"+m,answerPlaceholder:"",answerMaxlength:u.maxlength?'maxlength="'+u.maxlength+'"':"",answerString:"string"==typeof u.answer?u.answer:"",answerType:f,attrRequired:void 0!==s.required?"required":void 0!==o?o:"",fieldClass:q(),nestedAnswer:""!==j?'data-nested-index="'+p+'"':"",optionsHtml:"",progIdsJoined:j,questionNumber:m,answerCode:("option"===f?"select":f)+"-"+a+"-"+(h||0)+"-"+m+(""!==j?"-"+j:"")+"-"+p,attrChecks:s.checks?'data-checks="'+s.checks+'"':"",attrSubtype:u.subtype?'data-subtype="'+u.subtype+'"':"",validateIfFilled:void 0!==s.validateIfFilled?"data-validate-if-filled":""};if(c){const t=e.closest("[data-surveyjs-container]").querySelectorAll('[data-name="bind-surveyjs-answer"]')[r],a={id:C.answerCode,name:C.answerName,type:f,value:C.answerId};void 0!==s.required&&(a.required=!0);for(let e in a)t[e]=a[e];t.setAttribute("data-answer-id",C.answerId),t.closest("div").querySelector("label").setAttribute("for",C.answerCode),t.closest("div").querySelector("label span").textContent=u.answer}else{if("string"==typeof u.answer||"number"==typeof u.answer){let o=u.attribute?"attribute":u.nested?"nested":"option"===f?"select":f,n={answer:u,objData:C,beforeCode:b>0&&0===r?'<div class="surveyjs-field-indent">':"",afterCode:b>0&&r===i-1?"</div>":"",obj:s};if(void 0===g[o]&&(o="input"),x=g[o](t,n),C=x.objData,u.nested){v.push(p),d+=x.aHtml,d+=w(e,t,u.nested,a,l,C.attrRequired);continue}b>0&&r===i-1&&v.pop()}x.aHtml=y(t,x,C),d+=x.aHtml,"option"===f&&(r+=s.answers.length)}}return d},h=(e,t,s,a)=>{const r=e.formjs,o=e.getAttribute("name")||"";r.internals.storageName=s.storageName.replace(/{{surveyId}}/g,a.id),r.internals.storageName=s.storageName.replace(/{{surveyFormName}}/g,o);((e,t)=>{const s=document.createElement("div");s.innerHTML=e,Array.from(s.childNodes).forEach(e=>{t.appendChild(e)})})(((e,t,s=[])=>{const a=s[0].sort?s.sort((e,t)=>e.sort>t.sort):s,r=a.length;let o="";for(let s=0;s<r;s++){const r=a[s],n=r.checks?JSON.parse(r.checks):"",i=n.length>0?n[0]:"",l=n.length>0?n[1]:"";let d="",c=t.templates.question;if(d+=w(e,t,r,r.id,s),"hidden-privacy"===r.question){const t=e.closest("[data-surveyjs-container]").querySelector('[data-name="bind-surveyjs-answer"]');if(t){t.closest("[data-formjs-question]").setAttribute("data-question-id",r.id);continue}}if(c=c.replace(/{{questionId}}/g,r.id),c=c.replace(/{{questionNumber}}/g,s+1),c=c.replace(/{{questionText}}/g,r.question+(""!==n?" ("+l+" "+t.maxChoiceText+")":"")),c=c.replace(/{{answersHtml}}/g,d),c=c.replace(/{{fieldErrorTemplate}}/g,t.fieldErrorFeedback?t.templates.fieldError:""),t.fieldErrorFeedback&&-1!==t.templates.fieldError.indexOf("{{fieldErrorMessage}}")){const e=""!==n?t.fieldErrorMessageMultiChoice:t.fieldErrorMessage;c=c.replace(/{{fieldErrorMessage}}/g,e).replace(/{{checksMin}}/g,i).replace(/{{checksMax}}/g,l)}o+=c}return o})(e,t,a.questions),e.querySelector("[data-surveyjs-body]")),t.useLocalStorage&&((e,t)=>{const s=localStorage.getObject(t.storageName);if(s){const a=e.closest("[data-surveyjs-container]");t.storageArray=s,s.forEach(e=>{const t=a.querySelector('[name="'+e.field+'"]'),s=t.matches('[type="radio"], [type="checkbox"]'),r=s?a.querySelector('[name="'+e.field+'"][value="'+e.value+'"]'):t;s?r.checked=!0:r.value=e.value})}})(e,r.internals)};class b extends e{constructor(e,a={}){if(!a.url||"string"!=typeof a.url)throw new Error('"options.url" is missing or not a string!');const o="string"==typeof a.lang&&a.lang.toLowerCase(),n=o&&b.prototype.messages[o]?o:b.prototype.options.lang,l=r({},b.prototype.options,b.prototype.messages[n],a);-1!==l.templates.input.indexOf("{{inputTagCode}}")&&(l.templates.input=l.templates.input.replace(/{{inputTagCode}}/g,l.templates.inputTag)),l.templates.labelTag=l.templates.labelTag.replace(/{{labelClass}}/g,l.cssClasses.label),i().isAvailable||(l.useLocalStorage=!1),super(e,l);const d=this;d.internals=u,d.options.fieldOptions.validateOnEvents.split(" ").forEach(e=>{const t="blur"===e;d.formEl.addEventListener(e,m,t)}),d.formEl.addEventListener("fjs.form:submit",e=>{e.data.then(()=>{d.options.useLocalStorage&&localStorage.removeItem(d.internals.storageName)})}),d.formEl.querySelector("[data-surveyjs-body]").insertAdjacentHTML("beforebegin",d.options.loadingBox);const c=((e=location.href,t={})=>{let s;if(t.headers=new Headers(t.headers),t.timeout>0){const e=new AbortController,a=e.signal;t.signal=a,s=window.setTimeout(()=>{e.abort()},t.timeout)}return fetch(e,t).then(e=>e.ok?e.json():Promise.reject(e)).catch(e=>Promise.reject(e)).finally(()=>{s&&window.clearTimeout(s)})})(d.options.url,d.options.initAjaxOptions).then(e=>"success"!==e.status.toLowerCase()?Promise.reject(e):new Promise(t=>{e.data.questions&&e.data.questions.length>0?(h(d.formEl,d.options,d.internals,e.data),super.init().then(()=>{d.isInitialized=!0,d.data=e.data,s(d.data),d.formEl.closest("[data-surveyjs-container]").classList.add("surveyjs-init-success"),t(e)})):t(e)})).finally(()=>{const e=d.formEl.querySelector("[data-surveyjs-loading]");e&&e.parentNode.removeChild(e)});((e,t,s={},a={})=>{a=r({},{bubbles:!0},a);const o=new Event(t,a);o.data=s,e.dispatchEvent(o)})(d.formEl,t,c)}destroy(){var e;(e=this.formEl).formjs.options.fieldOptions.validateOnEvents.split(" ").forEach(t=>{const s="blur"===t;e.removeEventListener(t,m,s)}),super.destroy()}static addLanguage(e,t){const s=e.toLowerCase();b.prototype.messages[s]=r({},b.prototype.messages[s],t)}static setOptions(e){b.prototype.options=r({},b.prototype.options,e)}}b.prototype.isInitialized=!1,b.prototype.messages={it:{loadingBox:'<div class="surveyjs-loading" data-surveyjs-loading><i class="glyphicon glyphicon-refresh icon-spin"></i> Caricamento in corso...</div>',selectFirstOption:"Seleziona una risposta...",textareaPlaceholder:"Scrivi la tua risposta...",maxChoiceText:"RISPOSTE MAX",fieldErrorMessage:"&Egrave; necessario rispondere.",fieldErrorMessageMultiChoice:"Puoi scegliere da {{checksMin}} a {{checksMax}} risposte."},en:{loadingBox:'<div class="surveyjs-loading" data-surveyjs-loading><i class="glyphicon glyphicon-refresh icon-spin"></i> Loading...</div>',selectFirstOption:"Select your answer...",textareaPlaceholder:"Write here your answer...",maxChoiceText:"ANSWERS MAX",fieldErrorMessage:"Answer is necessary.",fieldErrorMessageMultiChoice:"You can choose from {{checksMin}} to {{checksMax}} answers."}},b.prototype.options=c,b.prototype.version="3.0.0";export default b;
//# sourceMappingURL=surveyjs-esm.min.js.map
